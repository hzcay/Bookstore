<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org" th:replace="~{admin/layout :: layout(~{::content})}">
<head>
    <title>B√°o c√°o Th·ªëng k√™</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div th:fragment="content">
    <h2 class="mb-4">B√°o c√°o Th·ªëng k√™</h2>

    <!-- ========== B·ªò L·ªåC B√ÅO C√ÅO ========== -->
    <div class="card shadow mb-4">
        <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-primary">
                <i class="bi bi-funnel-fill"></i> B·ªô l·ªçc b√°o c√°o
            </h6>
        </div>
        <div class="card-body">
            <form th:action="@{/admin/reports}" method="get">
                <div class="row g-3">
                    <div class="col-md-3">
                        <label class="form-label fw-bold">T·ª´ ng√†y</label>
                        <input type="date" name="fromDate" class="form-control" th:value="${fromDate}" required>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label fw-bold">ƒê·∫øn ng√†y</label>
                        <input type="date" name="toDate" class="form-control" th:value="${toDate}" required>
                    </div>
                    <div class="col-md-6 d-flex align-items-end">
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="bi bi-search"></i> Xem b√°o c√°o
                        </button>
                    </div>
                </div>
                
                <!-- N√∫t preset nhanh -->
                <div class="row mt-3">
                    <div class="col-12">
                        <div class="btn-group" role="group">
                            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="setDateRange('today')">
                                <i class="bi bi-calendar-day"></i> H√¥m nay
                            </button>
                            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="setDateRange('yesterday')">
                                <i class="bi bi-calendar-minus"></i> H√¥m qua
                            </button>
                            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="setDateRange('thisWeek')">
                                <i class="bi bi-calendar-week"></i> Tu·∫ßn n√†y
                            </button>
                            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="setDateRange('thisMonth')">
                                <i class="bi bi-calendar-month"></i> Th√°ng n√†y
                            </button>
                            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="setDateRange('lastMonth')">
                                <i class="bi bi-calendar-x"></i> Th√°ng tr∆∞·ªõc
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

        <div class="row mb-4">
        <div class="col-xl-4 col-md-6 mb-3">
            <div class="card border-left-primary shadow h-100">
                    <div class="card-body">
                        <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                            T·ªïng Doanh thu
                        </div>
                    <div class="h5 mb-0 font-weight-bold text-gray-800"
                             th:text="${#numbers.formatDecimal(totalRevenue, 0, 'COMMA', 0, 'POINT')} + ' ƒë'">
                            0 ƒë
                        </div>
                    </div>
                </div>
            </div>

        <div class="col-xl-4 col-md-6 mb-3">
            <div class="card border-left-success shadow h-100">
                    <div class="card-body">
                        <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                            T·ªïng ƒê∆°n h√†ng
                    </div>
                    <div class="h5 mb-0 font-weight-bold text-gray-800" th:text="${totalOrders}">0</div>
                    </div>
                </div>
            </div>

        <div class="col-xl-4 col-md-6 mb-3">
            <div class="card border-left-info shadow h-100">
                    <div class="card-body">
                        <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                            Gi√° tr·ªã TB/ƒê∆°n
                        </div>
                    <div class="h5 mb-0 font-weight-bold text-gray-800"
                             th:text="${#numbers.formatDecimal(avgOrderValue, 0, 'COMMA', 0, 'POINT')} + ' ƒë'">
                            0 ƒë
                        </div>
                    </div>
                </div>
            </div>
        </div>

    <div class="card mb-4" th:if="${salesReport != null && salesReport.revenueByPeriod != null && !salesReport.revenueByPeriod.empty}">
        <div class="card-header">
            <h6 class="m-0 font-weight-bold text-primary">Bi·ªÉu ƒë·ªì Doanh thu</h6>
                    </div>
        <div class="card-body">
            <canvas id="revenueChart" height="80"></canvas>
                </div>
            </div>

    <div class="row">
        <div class="col-lg-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h6 class="m-0 font-weight-bold text-primary">B√°o c√°o T·ªìn kho</h6>
                    </div>
                <div class="card-body" th:if="${inventoryReport != null}">
                    <table class="table table-sm">
                        <tr>
                            <th>T·ªïng s·ªë lo·∫°i s√°ch:</th>
                            <td th:text="${inventoryReport.totalBooks}">0</td>
                        </tr>
                        <tr>
                            <th>T·ªïng s·ªë l∆∞·ª£ng:</th>
                            <td th:text="${inventoryReport.totalQuantity}">0</td>
                        </tr>
                        <tr>
                            <th>Gi√° tr·ªã kho:</th>
                            <td th:text="${#numbers.formatDecimal(inventoryReport.totalValue, 0, 'COMMA', 0, 'POINT')} + ' ƒë'">0 ƒë</td>
                        </tr>
                        <tr>
                            <th>S·ªë s√°ch s·∫Øp h·∫øt:</th>
                            <td th:text="${inventoryReport.lowStockCount}">0</td>
                        </tr>
                    </table>
                    <canvas id="inventoryChart" height="150"></canvas>
                </div>
            </div>
        </div>

        <div class="col-lg-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h6 class="m-0 font-weight-bold text-primary">C√¥ng n·ª£ Nh√† cung c·∫•p</h6>
                    </div>
                <div class="card-body" th:if="${debtReport != null}">
                    <table class="table table-sm">
                        <tr>
                            <th>T·ªïng c√¥ng n·ª£:</th>
                            <td th:text="${#numbers.formatDecimal(debtReport.totalDebt, 0, 'COMMA', 0, 'POINT')} + ' ƒë'">0 ƒë</td>
                        </tr>
                        <tr>
                            <th>S·ªë NCC c√≤n n·ª£:</th>
                            <td th:text="${debtReport.suppliers != null ? debtReport.suppliers.size() : 0}">0</td>
                        </tr>
                    </table>
                    
                    <h6 class="mt-3">Chi ti·∫øt c√¥ng n·ª£:</h6>
                    <div class="table-responsive">
                        <table class="table table-sm">
                                <thead>
                                    <tr>
                                    <th>Nh√† cung c·∫•p</th>
                                    <th class="text-end">C√¥ng n·ª£</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="supplier : ${debtReport.suppliers}">
                                    <td th:text="${supplier.name}"></td>
                                    <td class="text-end" th:text="${#numbers.formatDecimal(supplier.debt, 0, 'COMMA', 0, 'POINT')} + ' ƒë'"></td>
                                    </tr>
                                </tbody>
                            </table>
                    </div>
                    </div>
                </div>
            </div>
        </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <script>
    // ========== X·ª¨ L√ù PRESET NG√ÄY ==========
    function setDateRange(type) {
        const today = new Date();
        const fromDateInput = document.querySelector('input[name="fromDate"]');
        const toDateInput = document.querySelector('input[name="toDate"]');
        
        let fromDate, toDate;
        
        switch(type) {
            case 'today':
                fromDate = toDate = formatDate(today);
                break;
            case 'yesterday':
                const yesterday = new Date(today);
                yesterday.setDate(yesterday.getDate() - 1);
                fromDate = toDate = formatDate(yesterday);
                break;
            case 'thisWeek':
                const startOfWeek = new Date(today);
                startOfWeek.setDate(today.getDate() - today.getDay());
                fromDate = formatDate(startOfWeek);
                toDate = formatDate(today);
                break;
            case 'thisMonth':
                fromDate = formatDate(new Date(today.getFullYear(), today.getMonth(), 1));
                toDate = formatDate(today);
                break;
            case 'lastMonth':
                const lastMonth = new Date(today.getFullYear(), today.getMonth() - 1, 1);
                const lastMonthEnd = new Date(today.getFullYear(), today.getMonth(), 0);
                fromDate = formatDate(lastMonth);
                toDate = formatDate(lastMonthEnd);
                break;
        }
        
        fromDateInput.value = fromDate;
        toDateInput.value = toDate;
        
        console.log('üìÖ ƒê√£ ch·ªçn:', type, 'T·ª´:', fromDate, 'ƒê·∫øn:', toDate);
    }
    
    function formatDate(date) {
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
    }
    
       // Auto-submit khi ch·ªçn preset
       function setDateRangeAndSubmit(type) {
           setDateRange(type);
           document.querySelector('form').submit();
       }
       
    // ========== TEST EMAIL ==========
    function testEmail() {
        const email = document.getElementById('autoEmail').value || 'admin@bookstore.com';
        
        if (!email) {
            alert('Vui l√≤ng nh·∫≠p email ƒë·ªÉ test');
            return;
        }
        
        fetch('/api/v1/reports/test-email?email=' + encodeURIComponent(email), {
            method: 'POST'
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                alert('‚ùå L·ªói: ' + data.error);
            } else {
                alert('‚úÖ ' + data.message);
            }
        })
        .catch(error => {
            console.error('‚ùå L·ªói test email:', error);
            alert('‚ùå L·ªói k·∫øt n·ªëi server');
        });
    }
    
    // ========== TEST AUTO REPORT ==========
    function testAutoReport() {
        const email = document.getElementById('autoEmail').value || 'admin@bookstore.com';
        
        if (!email) {
            alert('Vui l√≤ng nh·∫≠p email ƒë·ªÉ test');
            return;
        }
        
        if (!confirm('G·ª≠i b√°o c√°o test ngay b√¢y gi·ªù?')) {
            return;
        }
        
        fetch('/api/v1/reports/test-auto-report?email=' + encodeURIComponent(email), {
            method: 'POST'
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                alert('‚ùå L·ªói: ' + data.error);
            } else {
                alert('‚úÖ ' + data.message);
            }
        })
        .catch(error => {
            console.error('‚ùå L·ªói test auto report:', error);
            alert('‚ùå L·ªói k·∫øt n·ªëi server');
        });
    }
    </script>
    <script th:if="${salesReport != null && salesReport.revenueByPeriod != null && !salesReport.revenueByPeriod.empty}">
        const revenueData = {
            labels: [
                /*[# th:each="entry : ${salesReport.revenueByPeriod}" ]*/
                /*[[ ${entry.key} ]]*/,
                /*[/]*/
            ],
            datasets: [{
                label: 'Doanh thu',
                data: [
                    /*[# th:each="entry : ${salesReport.revenueByPeriod}" ]*/
                    /*[[ ${entry.value} ]]*/,
                    /*[/]*/
                ],
                backgroundColor: 'rgba(78, 115, 223, 0.2)',
                borderColor: 'rgba(78, 115, 223, 1)',
                borderWidth: 2,
                fill: true
            }]
        };

        new Chart(document.getElementById('revenueChart'), {
            type: 'line',
            data: revenueData,
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return 'Doanh thu: ' + new Intl.NumberFormat('vi-VN').format(context.parsed.y) + ' ƒë';
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return new Intl.NumberFormat('vi-VN', { notation: 'compact' }).format(value);
                            }
                        }
                    }
                }
            }
        });
    </script>

    <script th:if="${inventoryReport != null}">
        new Chart(document.getElementById('inventoryChart'), {
            type: 'doughnut',
            data: {
                labels: ['S√°ch t·ªìn kho', 'S√°ch s·∫Øp h·∫øt'],
                datasets: [{
                    data: [
                        /*[[ ${inventoryReport.totalQuantity - inventoryReport.lowStockCount} ]]*/,
                        /*[[ ${inventoryReport.lowStockCount} ]]*/
                    ],
                    backgroundColor: [
                        'rgba(28, 200, 138, 0.8)',
                        'rgba(231, 74, 59, 0.8)'
                    ]
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });
        </script>
        
        <!-- ========== BI·ªÇU ƒê·ªí PH√ÇN T√çCH S√ÅCH ========== -->
        <div class="card shadow mb-4 mt-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">
                    <i class="bi bi-pie-chart-fill"></i> Ph√¢n t√≠ch doanh thu theo s√°ch (Top 10)
                </h6>
            </div>
            <div class="card-body">
                <div style="height: 400px; position: relative;">
                    <canvas id="booksRevenueChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- ========== C·∫§U H√åNH G·ª¨I B√ÅO C√ÅO T·ª∞ ƒê·ªòNG ========== -->
        <div class="card shadow mb-4">
            <div class="card-header py-3 d-flex justify-content-between align-items-center">
                <h6 class="m-0 font-weight-bold text-primary">
                    <i class="bi bi-envelope-fill"></i> G·ª≠i b√°o c√°o t·ª± ƒë·ªông qua Email
                </h6>
                <button class="btn btn-sm btn-primary" onclick="openAutoReportModal()">
                    <i class="bi bi-gear-fill"></i> C·∫•u h√¨nh
                </button>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <p class="mb-1"><strong>Email nh·∫≠n b√°o c√°o:</strong></p>
                        <p id="configuredEmail" class="text-muted">admin@bookstore.com (m·∫∑c ƒë·ªãnh)</p>
                    </div>
                    <div class="col-md-4">
                        <p class="mb-1"><strong>Th·ªùi gian g·ª≠i:</strong></p>
                        <p id="configuredTime" class="text-muted">08:00 s√°ng h√†ng ng√†y</p>
                    </div>
                   <div class="col-md-4">
                       <p class="mb-1"><strong>Tr·∫°ng th√°i:</strong></p>
                       <p>
                           <span id="autoReportStatus" class="badge bg-success">ƒêang ho·∫°t ƒë·ªông</span>
                        <button class="btn btn-sm btn-outline-primary ms-2" onclick="testEmail()">
                            <i class="bi bi-envelope"></i> Test Email
                        </button>
                        <button class="btn btn-sm btn-outline-success ms-2" onclick="testAutoReport()">
                            <i class="bi bi-send"></i> Test Auto Report
                        </button>
                       </p>
                   </div>
                </div>
                <div class="alert alert-info mt-3 mb-0">
                    <i class="bi bi-info-circle-fill"></i>
                    B√°o c√°o PDF s·∫Ω ƒë∆∞·ª£c g·ª≠i t·ª± ƒë·ªông v√†o email ƒë√£ c·∫•u h√¨nh m·ªói ng√†y. 
                    B√°o c√°o bao g·ªìm: doanh thu, ƒë∆°n h√†ng, c√¥ng n·ª£ NCC, v√† bi·ªÉu ƒë·ªì ph√¢n t√≠ch.
                </div>
            </div>
        </div>
        
        <!-- Modal Setup Email -->
        <div class="modal fade" id="autoReportModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">C·∫•u h√¨nh g·ª≠i b√°o c√°o t·ª± ƒë·ªông</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">Email nh·∫≠n b√°o c√°o</label>
                            <input type="email" class="form-control" id="autoEmail" 
                                   placeholder="admin@bookstore.com" value="admin@bookstore.com">
                            <small class="text-muted">Email n√†y s·∫Ω nh·∫≠n b√°o c√°o PDF h√†ng ng√†y</small>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Th·ªùi gian g·ª≠i</label>
                            <input type="time" class="form-control" id="autoTime" value="08:00">
                            <small class="text-muted">Ch·ªçn gi·ªù g·ª≠i b√°o c√°o (VD: 08:00 = 8 gi·ªù s√°ng)</small>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="autoEnabled" checked>
                            <label class="form-check-label" for="autoEnabled">
                                B·∫≠t g·ª≠i b√°o c√°o t·ª± ƒë·ªông
                            </label>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                        <button type="button" class="btn btn-primary" onclick="saveAutoReportConfig()">
                            <i class="bi bi-save"></i> L∆∞u c·∫•u h√¨nh
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <script>
        // ========== Bi·ªÉu ƒë·ªì ph√¢n t√≠ch s√°ch ==========
        let booksChart = null;
        
        function loadBooksRevenueChart() {
            console.log('üöÄ B·∫Øt ƒë·∫ßu load bi·ªÉu ƒë·ªì...');
            
            const fromDate = document.querySelector('input[name="fromDate"]')?.value;
            const toDate = document.querySelector('input[name="toDate"]')?.value;
            
            console.log('From date:', fromDate);
            console.log('To date:', toDate);
            
            if (!fromDate || !toDate) {
                console.log('‚ö†Ô∏è Ch∆∞a c√≥ ng√†y, skip load chart');
                return;
            }
            
            const fromDateTime = fromDate + 'T00:00:00';
            const toDateTime = toDate + 'T23:59:59';
            
            console.log('üì° G·ªçi API:', `/api/v1/reports/books-revenue?from=${fromDateTime}&to=${toDateTime}`);
            
            fetch(`/api/v1/reports/books-revenue?from=${fromDateTime}&to=${toDateTime}`)
                .then(response => {
                    console.log('üì° API response status:', response.status);
                    return response.json();
                })
                .then(data => {
                    console.log('üìä D·ªØ li·ªáu nh·∫≠n ƒë∆∞·ª£c:', data);
                    
                    if (!data || data.length === 0) {
                        console.log('‚ö†Ô∏è Kh√¥ng c√≥ d·ªØ li·ªáu s√°ch');
                        return;
                    }
                    
                    const labels = data.map(item => item.title);
                    const revenues = data.map(item => item.revenue);
                    const percentages = data.map(item => item.percentage);
                    
                    console.log('üìà Labels:', labels);
                    console.log('üí∞ Revenues:', revenues);
                    
                    const ctx = document.getElementById('booksRevenueChart');
                    if (!ctx) {
                        console.error('‚ùå Kh√¥ng t√¨m th·∫•y canvas booksRevenueChart');
                        return;
                    }
                    
                    // Destroy chart c≈© n·∫øu c√≥
                    if (booksChart) {
                        booksChart.destroy();
                    }
                    
                    booksChart = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'Doanh thu',
                                data: revenues,
                                backgroundColor: [
                                    '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF',
                                    '#FF9F40', '#FF6384', '#C9CBCF', '#4BC0C0', '#FF6384'
                                ],
                                borderWidth: 2,
                                borderColor: '#fff'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'right'
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            const label = context.label || '';
                                            const value = context.parsed || 0;
                                            const percentage = percentages[context.dataIndex];
                                            return label + ': ' + value.toLocaleString('vi-VN') + ' ƒë (' + percentage + '%)';
                                        }
                                    }
                                }
                            }
                        }
                    });
                    
                    console.log('‚úÖ ƒê√£ t·∫°o bi·ªÉu ƒë·ªì th√†nh c√¥ng!');
                })
                .catch(error => {
                    console.error('‚ùå L·ªói load bi·ªÉu ƒë·ªì s√°ch:', error);
                });
        }
        
        // ========== Setup Email t·ª± ƒë·ªông ==========
        function openAutoReportModal() {
            const modal = new bootstrap.Modal(document.getElementById('autoReportModal'));
            modal.show();
        }
        
       function saveAutoReportConfig() {
           const email = document.getElementById('autoEmail').value;
           const time = document.getElementById('autoTime').value;
           const enabled = document.getElementById('autoEnabled').checked;
           
           if (!email) {
               alert('Vui l√≤ng nh·∫≠p email');
               return;
           }
           
           // G·ª≠i c·∫•u h√¨nh l√™n server
           fetch('/api/v1/reports/auto-report/configure', {
               method: 'POST',
               headers: {
                   'Content-Type': 'application/json',
               },
               body: JSON.stringify({
                   email: email,
                   time: time,
                   enabled: enabled
               })
           })
           .then(response => response.json())
           .then(data => {
               if (data.error) {
                   alert('‚ùå L·ªói: ' + data.error);
                   return;
               }
               
               // L∆∞u v√†o localStorage
               localStorage.setItem('autoReportEmail', email);
               localStorage.setItem('autoReportTime', time);
               localStorage.setItem('autoReportEnabled', enabled);
               
               // C·∫≠p nh·∫≠t UI
               document.getElementById('configuredEmail').textContent = email;
               document.getElementById('configuredTime').textContent = time + ' s√°ng h√†ng ng√†y';
               document.getElementById('autoReportStatus').textContent = enabled ? 'ƒêang ho·∫°t ƒë·ªông' : 'ƒê√£ t·∫Øt';
               document.getElementById('autoReportStatus').className = enabled ? 'badge bg-success' : 'badge bg-secondary';
               
               // ƒê√≥ng modal
               bootstrap.Modal.getInstance(document.getElementById('autoReportModal')).hide();
               
               alert('‚úÖ ƒê√£ l∆∞u c·∫•u h√¨nh th√†nh c√¥ng!');
               
               console.log('‚úÖ C·∫•u h√¨nh ƒë√£ l∆∞u:', data);
           })
           .catch(error => {
               console.error('‚ùå L·ªói c·∫•u h√¨nh:', error);
               alert('‚ùå L·ªói k·∫øt n·ªëi server');
           });
       }
        
        // Load c·∫•u h√¨nh khi trang load
        function loadAutoReportConfig() {
            const email = localStorage.getItem('autoReportEmail') || 'admin@bookstore.com';
            const time = localStorage.getItem('autoReportTime') || '08:00';
            const enabled = localStorage.getItem('autoReportEnabled') !== 'false';
            
            document.getElementById('configuredEmail').textContent = email;
            document.getElementById('configuredTime').textContent = time + ' s√°ng h√†ng ng√†y';
            document.getElementById('autoReportStatus').textContent = enabled ? 'ƒêang ho·∫°t ƒë·ªông' : 'ƒê√£ t·∫Øt';
            document.getElementById('autoReportStatus').className = enabled ? 'badge bg-success' : 'badge bg-secondary';
            
            document.getElementById('autoEmail').value = email;
            document.getElementById('autoTime').value = time;
            document.getElementById('autoEnabled').checked = enabled;
        }
        
        // Init khi trang load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Trang reports ƒë√£ load');
            loadAutoReportConfig();
            loadBooksRevenueChart();
        });
        
        // Load l·∫°i bi·ªÉu ƒë·ªì khi submit form filter
        const filterForm = document.querySelector('form[action*="reports"]');
        if (filterForm) {
            filterForm.addEventListener('submit', function() {
                console.log('üìä ƒêang load l·∫°i bi·ªÉu ƒë·ªì...');
                setTimeout(loadBooksRevenueChart, 500);
            });
        }
        </script>
    </div>
</body>
</html>
