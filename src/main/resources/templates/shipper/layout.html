<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
	th:fragment="layout(content)">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title th:text="${title} ?: 'Shipper Panel'">Shipper Panel</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
	rel="stylesheet">
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

<style>
html, body {
	height: 100%;
}

body {
	overflow-x: hidden;
	margin: 0;
	background-color: #f8f9fa;
}

#wrapper {
	overflow-x: hidden;
	display: flex;
}

#sidebar-wrapper {
	display: flex;
	flex-direction: column;
	justify-content: space-between;
	min-height: 100vh;
	width: 250px;
	position: fixed;
	left: 0;
	top: 0;
	z-index: 1000;
	background-color: #212529;
	color: white;
	transition: margin 0.25s ease-out;
}

#page-content-wrapper {
	flex: 1;
	margin-left: 250px;
	transition: all 0.25s ease-out;
}

#wrapper.toggled #sidebar-wrapper {
	margin-left: -250px;
}

#wrapper.toggled #page-content-wrapper {
	margin-left: 0;
}

/* Sidebar style */
.sidebar-heading {
	text-align: center;
	font-weight: bold;
	font-size: 1.4rem;
	padding: 1.2rem 0;
	border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.list-group-item {
	border: none;
	padding: 1rem 1.5rem;
	background-color: transparent;
	color: #adb5bd;
	transition: all 0.3s ease;
}

.list-group-item:hover {
	background-color: #495057;
	color: white;
	padding-left: 2rem;
}

.list-group-item.active {
	background-color: #0d6efd;
	color: white;
}

.list-group-item i {
	margin-right: 10px;
}

/* Logout button */
.logout-btn {
	margin: 15px;
	background-color: #dc3545;
	border: none;
	color: white;
	border-radius: 8px;
	padding: 10px;
	font-size: 16px;
	transition: background-color 0.3s;
}

.logout-btn:hover {
	background-color: #b02a37;
}

/* Navbar */
.navbar {
	background-color: #fff;
	border-bottom: 1px solid #dee2e6;
}

/* ✅ Responsive chỉnh cho điện thoại */
@media (max-width: 768px) {
	#sidebar-wrapper {
		margin-left: -250px;
	}
	#wrapper.toggled #sidebar-wrapper {
		margin-left: 0;
	}
	#page-content-wrapper {
		margin-left: 0;
	}

	body {
		font-size: 14px;
	}

	.navbar {
		position: sticky;
		top: 0;
		z-index: 1050;
	}

	.card, .table {
		font-size: 13px;
	}

	.table-responsive {
		overflow-x: auto;
		-webkit-overflow-scrolling: touch;
	}

	.btn {
		font-size: 13px;
		padding: 6px 10px;
	}

	.list-group-item {
		padding: 0.8rem 1.2rem;
	}

	.logout-btn {
		font-size: 14px;
		padding: 8px;
	}
}
</style>
</head>
<body>
	<div class="d-flex" id="wrapper">
		<div id="sidebar-wrapper"
			class="d-flex flex-column justify-content-between">
			<div>
				<div class="sidebar-heading">
					<i class="bi bi-truck"></i> Shipper
				</div>

				<div class="list-group list-group-flush">
					<a th:href="@{/shipper/home}"
						th:classappend="${activePage == 'home' ? 'active' : ''}"
						class="list-group-item list-group-item-action"> <i
						class="bi bi-speedometer2"></i> Trang chủ
					</a> <a th:href="@{/shipper/shipments}"
						th:classappend="${activePage == 'shipments' ? 'active' : ''}"
						class="list-group-item list-group-item-action"> <i
						class="bi bi-box-seam"></i> Đơn hàng
					</a> <a th:href="@{/shipper/report}"
						th:classappend="${activePage == 'report' ? 'active' : ''}"
						class="list-group-item list-group-item-action"> <i
						class="bi bi-bar-chart-line"></i> Báo cáo
					</a>
				</div>
			</div>

			<!-- Nút đăng xuất -->
			<div class="p-3">
				<button class="logout-btn w-100">
					<i class="bi bi-box-arrow-right"></i> Đăng xuất
				</button>
			</div>
		</div>

		<!-- Page Content -->
		<div id="page-content-wrapper">
			<nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
				<div class="container-fluid">
					<button class="btn btn-primary" id="menu-toggle">
						<i class="bi bi-list"></i>
					</button>
					<div class="ms-auto">
						<span class="me-3">Xin chào, <strong
							th:text="${shipperName ?: 'Shipper'}">Shipper</strong></span> 
						<a href="#" class="btn btn-outline-danger btn-sm"> 
							<i class="bi bi-box-arrow-right"></i> Đăng xuất
						</a>
					</div>
				</div>
			</nav>

			<div class="container-fluid px-4 py-4">
				<div th:if="${success}"
					class="alert alert-success alert-dismissible fade show" role="alert">
					<span th:text="${success}"></span>
					<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
				</div>
				<div th:if="${error}"
					class="alert alert-danger alert-dismissible fade show" role="alert">
					<span th:text="${error}"></span>
					<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
				</div>

				<div th:replace="${content}">Content goes here</div>
			</div>
		</div>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
	<script>
		document.addEventListener('DOMContentLoaded', function() {
			const menuToggle = document.getElementById('menu-toggle');
			const wrapper = document.getElementById('wrapper');
			if (menuToggle && wrapper) {
				menuToggle.addEventListener('click', function(e) {
					e.preventDefault();
					wrapper.classList.toggle('toggled');
				});
			}
			
			// Xử lý đăng xuất
			const logoutButtons = document.querySelectorAll('.logout-btn, .btn-outline-danger');
			logoutButtons.forEach(button => {
				button.addEventListener('click', function(e) {
					e.preventDefault();
					if (confirm('Bạn có chắc muốn đăng xuất?')) {
						// Gọi API đăng xuất
						fetch('/api/v1/auth/logout', {
							method: 'POST',
							headers: {
								'Content-Type': 'application/json'
							}
						})
						.then(response => {
							if (response.ok) {
								// Redirect về trang đăng nhập
								window.location.href = '/login';
							} else {
								alert('Lỗi đăng xuất. Vui lòng thử lại.');
							}
						})
						.catch(error => {
							console.error('Error:', error);
							alert('Lỗi đăng xuất. Vui lòng thử lại.');
						});
					}
				});
			});
		});
	</script>
</body>
</html>
